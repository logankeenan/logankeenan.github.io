<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description"
          content="Rendering Handlebar Templates with Rust and WASM">
    <title>Logan Keenan - Rendering Handlebar Templates with Rust and WASM</title>
    <link href="/css/styles.css" rel="stylesheet" />
</head>
<body>
<nav class="main-nav">
    <a href="/">Home</a>
    <a target="_blank" href="https://cultivatedsoftware.com">Hire Me</a>
    <a href="/talks">Talks</a>
</nav>

<h1>
    Rendering Handlebar Templates with Rust and WASM
</h1>
<time datetime="2020-06-24">
    June 24, 2020
</time>
<p>The Rust implementation of <a target="_blank" href="https://github.com/sunng87/handlebars-rust">Handlebars</a>
was easy to use on a server, so I wanted
to see what it would take to render templates in the browser. I'm going to demonstration two features for
Handlebars. However, it's not limited to these. Lets take a look at using partials and helpers.</p>
<h2 id="handlebar-partials">Handlebar Partials</h2>
<p>We'll leverage partials to create a page layout and nest a page within it.
The code was basically the same as the server. However, the templates cannot be read from
the file system in the browser. Thankfully, Rust has the <a target="_blank"
                                             href="https://doc.rust-lang.org/std/macro.include_str.html">include_str!</a>
macro which allows the templates to be read at compile time and included in the binary.</p>
<pre style="background-color:#2b303b;">
<code class="language-handlebars" data-lang="handlebars"><span style="color:#c0c5ce;">&lt;</span><span style="color:#bf616a;">section</span><span style="color:#c0c5ce;">&gt;
    &lt;</span><span style="color:#bf616a;">h1</span><span style="color:#c0c5ce;">&gt;Plantings 2020&lt;/</span><span style="color:#bf616a;">h1</span><span style="color:#c0c5ce;">&gt;
    {{&gt; </span><span style="color:#bf616a;">page_content</span><span style="color:#c0c5ce;">}}
&lt;/</span><span style="color:#bf616a;">section</span><span style="color:#c0c5ce;">&gt;
</span></code></pre><pre style="background-color:#2b303b;">
<code class="language-handlebars" data-lang="handlebars"><span style="color:#c0c5ce;">{{#&gt; </span><span style="color:#bf616a;">layout_page</span><span style="color:#c0c5ce;">}}
    {{#*</span><span style="color:#bf616a;">inline </span><span style="color:#c0c5ce;">&quot;</span><span style="color:#a3be8c;">page_content</span><span style="color:#c0c5ce;">&quot;}}
        &lt;</span><span style="color:#bf616a;">ul</span><span style="color:#c0c5ce;">&gt;
            {{#each </span><span style="color:#bf616a;">plants</span><span style="color:#c0c5ce;">}}
                &lt;</span><span style="color:#bf616a;">li</span><span style="color:#c0c5ce;">&gt;
                    {{</span><span style="color:#bf616a;">this</span><span style="color:#c0c5ce;">}}
                &lt;/</span><span style="color:#bf616a;">li</span><span style="color:#c0c5ce;">&gt;
            {{/each}}
        &lt;/</span><span style="color:#bf616a;">ul</span><span style="color:#c0c5ce;">&gt;
    {{/inline}}
{{/layout_page}}
</span></code></pre><pre style="background-color:#2b303b;">
<code class="language-rust" data-lang="rust"><span style="color:#b48ead;">let</span><span style="color:#c0c5ce;"> layout = include_str!(&quot;</span><span style="color:#a3be8c;">./templates/layout.hbs</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#b48ead;">let</span><span style="color:#c0c5ce;"> plantings_2020 = include_str!(&quot;</span><span style="color:#a3be8c;">templates/plantings_list.hbs</span><span style="color:#c0c5ce;">&quot;);

</span><span style="color:#b48ead;">let mut</span><span style="color:#c0c5ce;"> handlebars = Handlebars::new();
handlebars.</span><span style="color:#96b5b4;">register_template_string</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">layout_page</span><span style="color:#c0c5ce;">&quot;, layout).</span><span style="color:#96b5b4;">unwrap</span><span style="color:#c0c5ce;">();
</span><span style="color:#b48ead;">let</span><span style="color:#c0c5ce;"> result = handlebars.</span><span style="color:#96b5b4;">render_template</span><span style="color:#c0c5ce;">(
    plantings_2020,
    &amp;json!({&quot;</span><span style="color:#a3be8c;">plants</span><span style="color:#c0c5ce;">&quot;:[&quot;</span><span style="color:#a3be8c;">green beans</span><span style="color:#c0c5ce;">&quot;,&quot;</span><span style="color:#a3be8c;">tomatoes</span><span style="color:#c0c5ce;">&quot;,&quot;</span><span style="color:#a3be8c;">peas</span><span style="color:#c0c5ce;">&quot;,&quot;</span><span style="color:#a3be8c;">zucchini</span><span style="color:#c0c5ce;">&quot;,&quot;</span><span style="color:#a3be8c;">peppers</span><span style="color:#c0c5ce;">&quot;,&quot;</span><span style="color:#a3be8c;">cucumbers</span><span style="color:#c0c5ce;">&quot;,&quot;</span><span style="color:#a3be8c;">soy beans</span><span style="color:#c0c5ce;">&quot;,&quot;</span><span style="color:#a3be8c;">corn</span><span style="color:#c0c5ce;">&quot;,&quot;</span><span style="color:#a3be8c;">melons</span><span style="color:#c0c5ce;">&quot;]}),
);
</span></code></pre><h2 id="handlebar-helpers">Handlebar Helpers</h2>
<p>Fortunately, custom helpers is the same as on the server.</p>
<pre style="background-color:#2b303b;">
<code class="language-rust" data-lang="rust"><span style="color:#c0c5ce;">handlebars_helper!(uppercase: | </span><span style="color:#bf616a;">string_to_uppercase</span><span style="color:#c0c5ce;">: </span><span style="color:#b48ead;">str</span><span style="color:#c0c5ce;">| {
    string_to_uppercase.</span><span style="color:#96b5b4;">to_uppercase</span><span style="color:#c0c5ce;">()
});
handlebars.</span><span style="color:#96b5b4;">register_helper</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">uppercase</span><span style="color:#c0c5ce;">&quot;, Box::new(uppercase));
</span></code></pre><h2 id="next-steps">Next Steps</h2>
<p>Check out the demo <a href="https://github.com/logankeenan/logankeenan.github.io/tree/master/repos/wasm-handlebars">repository</a>
to see the full code as well as a working <a href="/demos/wasm-handlebars/index.html">demo</a>.
The demo simply calls the Rust code (compiled to Wasm) which returns some html markup which is set to the
document body.</p>
<p>This solution doesn't seem all that developer friendly. Developers would have to remember to include any new template
so they'll be contained in the binary. The <a target="_blank" href="https://crates.io/crates/include_dir">include_dir</a>
crate could allow for the creation of a template factory using path with filename as a parameter for a given template.</p>


</body>
</html>
